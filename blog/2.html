<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<title>
			Joplin To Anki
		</title>
		<meta charset='utf-8'>
		<link rel="stylesheet" type="text/css" href="../css/index.css">
		<link rel="icon" href="../icon.png">
	</head>
	<body>
		<div id="headerdiv">
			<a href="index.html">Back</a>
		</div>
		<div id="maindiv">
			<h1>Joplin To Anki</h1>
				<p>2022-06-11</p>
			<hr />
			<h2>Introduction</h2>
			<p>This blog post is about a program I'm working on. It helps me syncronize information between Joplin (or Markdown files in general) and Anki. It's a proof of concept and I'm very much looking for feedback and ideas.</p>
			<h2>Terminology</h2>	
			<h3> <img src="img/Anki-icon.svg" style="height: 1em; margin:0px; border: 0px; fill:red; margin-bottom: -2px; border-radius: 2px;"> Anki</h3>
			<p>Anki is one of my favorite pieces of software. It lets you create <i>flashcards</i>. These flashcards have a front and a back side. You're shown the front, and you're expected to remember the back. If you remember correctly, you succeeded - this means you're one step closer to never forgetting the information on the card again.</p>
			<p>Anki handles the scheduling of these cards, showing you the cards you fail more often, so you're forced to learn them. Anki is great for language-learning, school and college, and really whatever you find a way to use Anki for.</p>
			<p>It's extensible and allows for a lot of customization. In fact I have already shared some of my <a href="https://github.com/MNandor/anki-cards">card templates</a>.</p>
			<h3> <img src="img/Joplin-icon.svg" style="height: 1em; margin:0px; border: 0px; fill:red; margin-bottom: -2px; border-radius: 2px;"> Joplin</h3>
			<p>Joplin is a note-taking program. It helps you manage your notes and notebooks, offer tools to write Markdown, and renders said Markdown on screen.</p>
			<p>Joplin is mainly a Markdown editor, but it correctly renders most HTML written in it as well.</p>
			<p>If you're familiar with OneNote, Obsidian, or EverNote, Joplin is similar. Except it's open-source!</p>
			<h3> <img src="img/Markdown-mark.svg" style="height: 1em; margin:0px; border: 0px; fill:red; margin-bottom: -2px;"> Markdown</h3>
			<p>Markdown works similarly to HTML: you can write text in Markdown, and define formatting for that text in the same file.</p>
			<p>Markdown is designed to be easier to write. While HTML requires pairs of tags, in Markdown, a couple symbols are all it takes to create the formatting.</p>
			<p>In HTML, you can type <code>&lt;b&gt;text&lt;/b&gt;</code> to get bold <b>text</b>. Doing the same is much easier in Markdown, by typing <code>**text**</code>Same goes for <i>italics</i>: <code>&lt;i&gt;italics&lt;/i&gt;</code> can be written as <code>*italics*</code>.</p>
			The relevant parts of Markdown syntax can be seen below.
			<div id="comparison">
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2a_markdown.png"><figcaption style="display: inline-block;">Markdown</figcaption></figure>
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2a_html.png"><figcaption style="display: inline-block;">HTML equivalent</figcaption></figure>
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2a_rendered.png"><figcaption style="display: inline-block;">Rendered</figcaption></figure>
			</div>
			<h2>The Problem I Want To Solve</h2>
			<p>Anki is <u>really good</u> at helping you memorize information. I use it every day. However, it's specifically designed for <i>atomic</i> pieces on information. Learning 100 foreign words means creating 100 cards. Understanding of grammatical structures is not something you would use Anki for.</p>
			<p>In contrast, the free-form nature of Markdown editors like Joplin are perfectly suitable for recording information in whatever arbitrary way makes sense to you. However, there is no <abbr title="Spaced Repetition System">SRS</abbr> functionality that Anki is famous for.</p>
			<p>I personally create Joplin notes for things I study. They act as sort of "wiki pages" or "cheat sheets".</p>
			Here is part of my (work-in-progress) Joplin page for studying the Vim text editor.<br>
			<img src="img/j2avim.png">
			<p>Notice how the Note page contains explanatory <u>Text Notes</u>, as well as a nicely formatted <u>Markdown Table of Hotkeys</u>.</p>
			<p>The page also follows a set structure as seen in <u>Table of Content</u>.</p>
			<p>You could imagine a similar layout for language-learning. A Markdown table could contain words with their foreign translations, with some explanation mixed in between these tables. The <u>Headings</u> could serve as topic markers, such as names of animals or colors.</p>
			<p><b>I don't want to manually input all of this into Anki.</b></p>

			<h2>Tables to Cards</h2>
			<p>I decided to write a program that lets me take the information in Markdown tables and create Anki cards based on them. This way:</p>
			<ul>
				<li>The two sources of information don't go "out of sync" with each other, since I can just update on based on the other</li>
				<li>I can have a nice "cheat sheet" Joplin page I can open to quickly look something up, or even print</li>
				<li>I can have my atomic Anki cards that I can practice</li>
			</ul>

			From the table above, these are some of the cards I generated.
			<div id="comparison">
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2av1.png"><figcaption style="display: inline-block;">Card 1</figcaption></figure>
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2av2.png"><figcaption style="display: inline-block;">Card 2</figcaption></figure>
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2av3.png"><figcaption style="display: inline-block;">Card 3</figcaption></figure>
			</div>
			<br>
			The way I achieved this was to export fields from the Markdown table into Anki card fields.
			<img src="img/j2aconv.png">

			<br>
			<sub>(Ignore the fact that <i>Quit file</i> and <i>How to quit file?</i> are not the exact same wording.)</sub>
			<p>Since Markdown is just text with formatting, it's possible to just locate all Markdown tables, get the names of the columns from the top row (the table header) and export each row accordingly into its own Anki card.</p>
			<p>Anki already has a "mass import" feature. As long as we can export the Joplin data into the proper CSV format, we can easily import everything into Anki.</p>
			<p>The tag <code>vim::file</code> can also be inferred from the name of the Joplin page <i>Vim</i> and the <u>Heading</u> under which we get our data from. A card created from under the heading <i>Motions</i> and subheading <i>Word Motions</i> would have the tag <code>vim::motions::word-motions</code>.</p>

			The result is the following CSV:
<code><pre>vim::file,Quit file,,`:q`,,,
vim::file,Force quit file,ZQ,`:q!`,,,
vim::file,Write file,,`:w`,,ZS,
vim::file,Write and quit file,ZZ,`:wq`,,,
vim::file,Undo, redo,u Ctrl-r,,,,
vim::file,Write with sudo,,`:w !sudo tee %`,:write into stdin of !command&lt;br&gt;% is the file's name,,</pre></code>
			Better visualized:
			<br>

			<img src="img/j2acsv.png">
			<p>Notice how it looks pretty much the same as the original table. That's what we wanted.</p>


			<h2>Comparison Tool</h2>
			<p>The problem with two different tools managing the same source of information is that they can get out of sync with each other. You might create an Anki card without updating Joplin, or update Joplin without propagating the changes to Anki.</p>
			<p>I created a diff tool to compare the data in Joplin and Anki.</p>

			Here's some sample output when the diff tool finds a matching line in a Markdown table and an Anki card.

			<div style="border-left: 2px solid #00FF00; margin-left: 32px;">
			<p><font color="#FFFF00">{'Front': 'quit file', 'Command': ':q', 'tags': 'vim::file'}</font></p>
			<p><font color="#0000FF">15 Quit file||`:q`||</font></p>
			<p><font color="#00FFFF">{'Front': 'How to quit file?', 'Notes': '', 'Command': ':q', 'Hotkey': '', 'Perskey': '', 'Mnemonic': '', 'tags': 'vim::file'}</font></p>
			</div>

			
			<ul>
				<li>The <font color="#0000FF">blue</font> part is the exact line as it appears in Joplin. The line number (15) is also there to make it easier to find.</li>
				<li>The <font color="#00FFFF">teal</font> part is the data as it's stored in Anki. It's represented as a Python map of Field name to content.</li>
				<li>The <font color="#FFFF00">yellow</font> part is the comparison map: it's used for comparison.
					<ul>
						<li>Both the Joplin and the Anki data is converted into one of these. If they result in the same comparison map, they're considered to be identical.</li>
						<li>Comparison maps don't include information that doesn't matter. Remember how <i>Quit file</i> and <i>How to quit file?</i> had slightly different wordings? This is why those are still considered the same card.</li>
						<li>Text here is also all-lowercase for the same reason.</li>
						<li>Some additional formatting is also stripped.</li>
						<li>How the comparison is made can be customized. This is just what works for me.</li>
						<li>Empty fields are ignored completely.</li>
					</ul>
				</li>
			</ul>

			Here's another example. These are considered "similar".

			<div style="border-left: 2px solid #FF00FF; margin-left: 32px;">
				<p><font color="#FFFF00">{'Front': 'play the latest macro played', 'Hotkey': '@@', 'tags': '<font color="#FF00FF">vim::macros</font>'}</font></p>
			<p><font color="#0000FF">123 Play the latest macro played|@@</font></p>
			<p><font color="#FFFF00">{'Front': 'play the latest macro played', 'Hotkey': '@@'}</font></p>
			<p><font color="#00FFFF">{'Front': 'How do you play the latest macro played?', 'Notes': '', 'Command': '', 'Hotkey': '@@', 'Perskey': '', 'Mnemonic': '', 'tags': ''</font></p>
			</div>

			<ul>
				<li>Notice how there are two <font color="#FFFF00">comparison maps</font>. This is because they are not identical.</li>
				<li>The Joplin line comes with a tag, but the Anki card doesn't have it. This is marked in <font color="#FF00FF">pink</font>. This is the reason the two comparison maps differ.</li>
				<li>By adding <code>vim::macros</code> to the <font color="#00FFFF">Anki</font> card, this would become identical.</li>
			</ul>

			<h2>Exclude</h2>
			<p>You might want to have cards in a deck that don't interact with Joplin, or table rows in Joplin that don't get exported to Anki.</p>
			<p>Simply add <code>j2aignore</code> either as a tag in Anki, or an HTML comment inside Joplin. Adding the comment in the table header results in the entire table being ignored.</p>

			<div id="comparison">
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2aigna.png"><figcaption style="display: inline-block;">Ignore Anki</figcaption></figure>
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2aignj.png"><figcaption style="display: inline-block;">Ignore Markdown row</figcaption></figure>
				<figure style="display: inline-block; width: 25%; margin: 8px;"><img src="img/j2aignt.png"><figcaption style="display: inline-block;">Ignore Markdown table</figcaption></figure>
			</div>

			<h2>Want To Try It?</h2>
			<p>The source and download for the tool can be found <font size="6"><a href="https://github.com/MNandor/joplin-to-anki">here</a></font>.</p>
			<p>Please keep in mind that the code is very much work-in-progess. It's <u>undocumented</u> and <u>breaks in pretty much all use cases except the exact same thing I did</u>. In particular, I have no idea what happens if:</p>

			<ul>
				<li>An Anki Note has multiple card templates</li>
				<li>If an Anki Deck has multiple different Note types</li>
				<li>If either Joplin or Anki contains images</li>
			</ul>

			<p>Here's a list of intended features I want to add</p>
			<ol>
				<li>Better configuration: let user select Joplin Note / Anki Deck combinations without editing config file each time</li>
				<li>Automatic importing to Anki, without user interaction</li>
				<li>The reverse: update Joplin based on Anki?</li>
				<li>Logging and backups</li>
				<li>Make everything more user-friendly</li>
				<li>Reference cards in Joplin in ways other than tables (no idea how yet)</li>
				<li>Allow for multiple Joplin notes to be associated with multiple Anki decks (instead of always 1-to-1)</li>
				<li>The hierarchical tag structure might be nice to visualize somehow</li>
			</ol>

		</div>
	</body>
</html>
